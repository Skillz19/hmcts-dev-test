{% extends "../template.njk" %}
{% from "../macros/csrf.njk" import csrfProtection %}

{% block content %}
  <h1 class="govuk-heading-l">Tasks</h1>

  <a href="/tasks/new" class="govuk-button govuk-button--start">Create New Task</a>

  {% if tasks.length %}
    <table class="govuk-table">
      <thead class="govuk-table__head">
        <tr class="govuk-table__row">
          <th class="govuk-table__header">Title</th>
          <th class="govuk-table__header">Description</th>
          <th class="govuk-table__header">Status</th>
          <th class="govuk-table__header">Due Date</th>
          <th class="govuk-table__header">Actions</th>
        </tr>
      </thead>
      <tbody class="govuk-table__body">
        {% for task in tasks %}
          <tr class="govuk-table__row">
            <td class="govuk-table__cell">{{ task.title }}</td>
            <td class="govuk-table__cell">{{ task.description }}</td>
            <td class="govuk-table__cell">{{ task.status }}</td>
            <td class="govuk-table__cell">{{ task.dueDate | formatDate }}</td>
            <td class="govuk-table__cell">
              <a href="/tasks/{{ task.id }}" class="govuk-button govuk-button--secondary" style="padding: 0.1em 0.3em;">View</a>
              <a href="/tasks/{{ task.id }}/edit" class="govuk-button govuk-button--secondary" style="padding: 0.1em 0.3em;">Edit</a>
              <form action="/tasks/{{ task.id }}/delete" method="POST" style="display:inline;">
                {{ csrfProtection(csrfToken) }}
                <button type="submit" class="govuk-button govuk-button--warning" style="padding: 0.1em 0.3em;">Delete</button>
              </form>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <nav class="govuk-!-margin-top-4" aria-label="Task pagination">
      {% if not first %}
        <a
          class="govuk-link govuk-!-margin-right-4"
          href="/tasks?page={{ page - 1 }}&size={{ size }}&sortBy={{ sortBy }}&direction={{ direction }}"
        >
          Previous
        </a>
      {% endif %}

      {% if not last %}
        <a
          class="govuk-link"
          href="/tasks?page={{ page + 1 }}&size={{ size }}&sortBy={{ sortBy }}&direction={{ direction }}"
        >
          Next
        </a>
      {% endif %}
    </nav>
  {% else %}
    <p>No tasks available.</p>
  {% endif %}
{% endblock %}
